{% extends 'base.html' %}

{% block content %}
<div class="container-fluid tabela">
    <!-- Cabeçalho da tabela -->
    <div class="d-flex justify-content-between align-items-center mb-4 header-tabela">
        <div> 
            <h2 class="mb-1">{{ tabela.nome }}</h2>
            <p class="text-muted mb-0">{{ tabela.descricao }}</p>
        </div>
        <div class="d-flex gap-2">
            <button class="btn btn-outline-secondary btn-sm">
                <i class="bi bi-funnel"></i> Filtros
            </button>
            <button class="btn btn-outline-secondary btn-sm">
                <i class="bi bi-upload"></i> Exportar
            </button>
            <button class="btn btn-outline-secondary btn-sm">
                <i class="bi bi-download"></i> Importar
            </button>
            <a href="{% url 'adicionar_processo_tabela' tabela.id %}" class="btn btn-primary btn-sm">
                <i class="bi bi-plus"></i> Novo Processo
            </a>
        </div>
    </div>

    <!-- Tabela -->
    <div class="table-responsive">
        <table class="table table-hover">
            <thead class="table-light">
                <tr>
                    <th>Nome <i class="bi bi-arrow-down"></i></th>
                    <th>Matrícula <i class="bi bi-arrow-down"></i></th>
                    <th>Nº processo <i class="bi bi-arrow-down"></i></th>
                    <th>Data de abertura <i class="bi bi-arrow-down"></i></th>
                    <th>Data de retorno <i class="bi bi-arrow-down"></i></th>
                    <th>Setor <i class="bi bi-arrow-down"></i></th>
                    <th>Bolsa <i class="bi bi-arrow-down"></i></th>
                    <th>Status <i class="bi bi-arrow-down"></i></th>
                    <th>Assunto <i class="bi bi-arrow-down"></i></th>
                    <th class="col-acoes">Ações</th>
                </tr>
            </thead>
            <tbody>
                {% for processo in processos %}
                <tr>
                    <td><strong>{{ processo.nome }}</strong></td>
                    <td class="text-muted">{{ processo.matricula }}</td>
                    <td class="text-muted col-numero-processo">{{ processo.numero_processo }}</td>
                    <td class="text-muted col-data-abertura">{{ processo.data_abertura|date:"d/m/Y" }}</td>
                    <td class="text-muted col-data-retorno">{{ processo.data_retorno|date:"d/m/Y" }}</td>
                    <td class="text-muted col-setor">{{ processo.setor }}</td>
                    <td class="col-bolsa">
                        {% if processo.bolsa == 'Sim' %}
                            <span class="badge bg-success">Sim</span>
                        {% else %}
                            <span class="badge bg-danger">Não</span>
                        {% endif %}
                    </td>
                    <td class="col-status">
                        {% if processo.status == 'concluido' %}
                            <span class="badge bg-success">Concluído</span>
                        {% elif processo.status == 'em_andamento' %}
                            <span class="badge bg-warning">Em andamento</span>
                        {% else %}
                            <span class="badge bg-info">{{ processo.get_status_display }}</span>
                        {% endif %}
                    </td>
                    <td class="text-muted col-assunto">{{ processo.assunto }}</td>
                    <td class="col-acoes">
                        <a href="{% url 'editar_processo' processo.id %}" class="btn btn-outline-secondary btn-sm">
                            <i class="bi bi-pencil"></i>
                        </a>
                        <form action="{% url 'deletar_processo' processo.id %}" method="post" style="display: inline;">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-outline-danger btn-sm" onclick="return confirm('Tem certeza que deseja deletar este processo?');">
                                <i class="bi bi-trash"></i>
                            </button>
                        </form>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="11" class="text-center text-muted py-4">
                        <i class="bi bi-inbox" style="font-size: 3rem; opacity: 0.3;"></i>
                        <br>
                        Nenhum processo encontrado.
                        <br>
                        <small>Clique em "Novo Processo" para adicionar o primeiro.</small>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Informações Adicionais -->
    <div class="card mt-4">
        <div class="card-body">
            <h5 class="card-title">Informações adicionais</h5>
            <p class="card-text">Processos CIC: {{ count_cic }} processos listados</p>
            <p class="card-text">Processos DPQ: {{ count_dpq }} processos listados</p>
        </div>
    </div>
</div>

{% endblock %}

{% block extra_css %}
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css" rel="stylesheet">
<style>
.tabela {
    margin-top: 1em;
    margin-bottom: 1em;
}
.header-tabela {
    padding-bottom: 0.1em;
}
.table th {
    background-color: #f8f9fa;
    border-bottom: 2px solid #dee2e6;
    font-weight: 600;
    color: #495057;
    white-space: nowrap;
    position: sticky;
    top: 0;
    z-index: 1;
}

.table tbody tr:hover {
    background-color: #f8f9fa;
}

.badge {
    font-size: 0.75rem;
    padding: 0.35em 0.65em;
}

.btn-sm {
    padding: 0.25rem 0.5rem;
    font-size: 0.875rem;
}

.form-check-input:disabled {
    opacity: 0.3;
}

.bi-arrow-down {
    font-size: 0.75rem;
    color: #6c757d;
}

.table-responsive {
    border-radius: 0.375rem;
    box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
    max-height: 25em;  /*Defina a altura máxima que desejar */
    overflow-y: auto; /* Adiciona a barra de rolagem vertical */
}

.col-assunto {
    width: 12%;
}

.col-assunto {
    white-space: normal;
    word-break: break-word;
}

.col-data-abertura,
.col-data-retorno,
.col-numero-processo {
    width: 10%;
}
.col-acoes {
    width: 8%;
    text-align: center;
}
.col-status,
.col-bolsa,
.col-setor {
    width: 5%;
}

.card-body {
    background-color: #f8f9fa;
}
.card-body p {
    margin: 0;  
}
</style>
{% endblock %}