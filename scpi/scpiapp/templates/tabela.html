{% extends 'base.html' %}

{% block content %}
<div class="container-fluid tabela">
    <!-- Cabeçalho da tabela -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div> 
            <h2 class="mb-1">Titulo da tabela</h2>
            <p class="text-muted mb-0">Corpo de descrição aqui</p>
        </div>
        <div class="d-flex gap-2">
            <button class="btn btn-outline-secondary btn-sm">
                <i class="bi bi-pencil"></i> Editar
            </button>
            <button class="btn btn-outline-danger btn-sm">
                <i class="bi bi-trash"></i> Deletar
            </button>
            <button class="btn btn-outline-secondary btn-sm">
                <i class="bi bi-funnel"></i> Filtros
            </button>
            <button class="btn btn-outline-secondary btn-sm">
                <i class="bi bi-upload"></i> Exportar
            </button>
            <button class="btn btn-outline-secondary btn-sm">
                <i class="bi bi-download"></i> Importar
            </button>
            <a href="{% url 'processo' %}" class="btn btn-primary btn-sm">
                <i class="bi bi-plus"></i> Nova linha
            </a>
        </div>
    </div>

    <!-- Tabela -->
    <div class="table-responsive">
        <table class="table table-hover">
            <thead class="table-light">
                <tr>
                    <th>
                        <input type="checkbox" class="form-check-input" id="selectAll">
                    </th>
                    <th>Nome <i class="bi bi-arrow-down"></i></th>
                    <th>Matrícula <i class="bi bi-arrow-down"></i></th>
                    <th>Nº processo <i class="bi bi-arrow-down"></i></th>
                    <th>Data de abertura <i class="bi bi-arrow-down"></i></th>
                    <th>Data de retorno <i class="bi bi-arrow-down"></i></th>
                    <th>Setor <i class="bi bi-arrow-down"></i></th>
                    <th>Bolsa <i class="bi bi-arrow-down"></i></th>
                    <th>Status <i class="bi bi-arrow-down"></i></th>
                    <th>Assunto <i class="bi bi-arrow-down"></i></th>
                </tr>
            </thead>
            <tbody>
                {% for processo in processos %}
                <tr>
                    <td><input type="checkbox" class="form-check-input row-checkbox" value="{{ processo.id }}"></td>
                    <td><strong>{{ processo.nome }}</strong></td>
                    <td class="text-muted">{{ processo.matricula }}</td>
                    <td class="text-muted">{{ processo.numero_processo }}</td>
                    <td class="text-muted">{{ processo.data_abertura|date:"d/m/Y" }}</td>
                    <td class="text-muted">
                        {% if processo.data_retorno %}
                            {{ processo.data_retorno|date:"d/m/Y" }}
                        {% else %}
                            -
                        {% endif %}
                    </td>
                    <td class="text-muted">{{ processo.setor_origem }}</td>
                    <td>
                        {% if processo.is_active %}
                            <span class="badge bg-success">Active</span>
                        {% else %}
                            <span class="badge bg-secondary">Inactive</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if processo.status == 'concluido' %}
                            <span class="badge bg-success">Concluído</span>
                        {% elif processo.status == 'em_andamento' %}
                            <span class="badge bg-warning">Em andamento</span>
                        {% else %}
                            <span class="badge bg-info">Aberto</span>
                        {% endif %}
                    </td>
                    <td class="text-muted">{{ processo.assunto|truncatechars:30 }}</td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="10" class="text-center text-muted py-4">
                        <i class="bi bi-inbox" style="font-size: 3rem; opacity: 0.3;"></i>
                        <br>
                        Nenhum processo encontrado.
                        <br>
                        <small>Clique em "Nova linha" para adicionar o primeiro processo.</small>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<script>
// Script para funcionalidade do checkbox "Selecionar todos"
document.getElementById('selectAll').addEventListener('change', function() {
    const checkboxes = document.querySelectorAll('.row-checkbox:not([disabled])');
    checkboxes.forEach(checkbox => {
        checkbox.checked = this.checked;
    });
});

// Atualizar o estado do checkbox "Selecionar todos" quando checkboxes individuais são alterados
document.querySelectorAll('.row-checkbox:not([disabled])').forEach(checkbox => {
    checkbox.addEventListener('change', function() {
        const selectAllCheckbox = document.getElementById('selectAll');
        const enabledCheckboxes = document.querySelectorAll('.row-checkbox:not([disabled])');
        const checkedCheckboxes = document.querySelectorAll('.row-checkbox:not([disabled]):checked');
        
        if (checkedCheckboxes.length === 0) {
            selectAllCheckbox.indeterminate = false;
            selectAllCheckbox.checked = false;
        } else if (checkedCheckboxes.length === enabledCheckboxes.length) {
            selectAllCheckbox.indeterminate = false;
            selectAllCheckbox.checked = true;
        } else {
            selectAllCheckbox.indeterminate = true;
        }
    });
});
</script>
{% endblock %}

{% block extra_css %}
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css" rel="stylesheet">
<style>
.table th {
    background-color: #f8f9fa;
    border-bottom: 2px solid #dee2e6;
    font-weight: 600;
    color: #495057;
    white-space: nowrap;
}

.table tbody tr:hover {
    background-color: #f8f9fa;
}

.badge {
    font-size: 0.75rem;
    padding: 0.35em 0.65em;
}

.btn-sm {
    padding: 0.25rem 0.5rem;
    font-size: 0.875rem;
}

.form-check-input:disabled {
    opacity: 0.3;
}

.bi-arrow-down {
    font-size: 0.75rem;
    color: #6c757d;
}

.table-responsive {
    border-radius: 0.375rem;
    box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
}
</style>
{% endblock %}